<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>インメモリキャッシュ</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REV="MADE"
HREF="mailto:pgsql-docs@postgresql.org"><LINK
REL="HOME"
TITLE="Pgpool-II 3.6.4 文書"
HREF="index.html"><LINK
REL="UP"
TITLE="サーバの設定"
HREF="runtime-config.html"><LINK
REL="PREVIOUS"
TITLE="ストリーミングレプリケーションのチェック"
HREF="runtime-streaming-replication-check.html"><LINK
REL="NEXT"
TITLE="Secure Sockect Layer (SSL)"
HREF="runtime-ssl.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="stylesheet.css"><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=utf-8"><META
NAME="creation"
CONTENT="2017-05-11T10:04:34"></HEAD
><BODY
CLASS="SECT1"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="4"
ALIGN="center"
VALIGN="bottom"
><A
HREF="index.html"
>Pgpool-II 3.6.4 文書</A
></TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
TITLE="ストリーミングレプリケーションのチェック"
HREF="runtime-streaming-replication-check.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
HREF="runtime-config.html"
ACCESSKEY="U"
>上に戻る</A
></TD
><TD
WIDTH="60%"
ALIGN="center"
VALIGN="bottom"
>第 5章サーバの設定</TD
><TD
WIDTH="20%"
ALIGN="right"
VALIGN="top"
><A
TITLE="Secure Sockect Layer (SSL)"
HREF="runtime-ssl.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="RUNTIME-IN-MEMORY-QUERY-CACHE"
>5.12. インメモリキャッシュ</A
></H1
><P
><SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>の全てのモードでインメモリクエリキャッシュを利用することができます。
ディスク上のクエリキャッシュと違い、メモリ上にキャッシュが置かれる特性上高速です。
また、テーブルが更新によりキャッシュが古くなっても、<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>の再起動の必要がありません。
  </P
><P
>インメモリクエリキャッシュは、SELECT文(拡張問い合わせの場合は更にバインドパラメータ)と 検索結果をペアで記録します。
同じSELECT文が発行された場合に、<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>はキャッシュから結果を返します。
<ACRONYM
CLASS="ACRONYM"
>SQL</ACRONYM
>の解析も<SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
>へのアクセスも行われないため、インメモリキャッシュからの結果の提供は非常に高速です。

  </P
><P
>反面、キャッシュをストアするオーバヘッドが生じるので、通常の方法より遅くなる場合も有ります。
また、あるテーブルが更新された場合、<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>は自動的にそのテーブルに関係する全てのキャッシュを削除します。
そのため、更新が多いシステムではパフォーマンスが悪くなります。
キャッシュのヒット率が70%以下の場合は、インメモリクエリキャッシュ無効にしたほうがいいかもしれません。
  </P
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="RUNTIME-IN-MEMORY-QUERY-CACHE-ENABLING"
>5.12.1. インメモリクエリキャッシュを有効にする</A
></H2
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><A
NAME="GUC-MEMORY-CACHE-ENABLED"
></A
><TT
CLASS="VARNAME"
>memory_cache_enabled</TT
> (<TT
CLASS="TYPE"
>boolean</TT
>)
					</DT
><DD
><P
>onにするとメモリキャッシュが有効になります。
デフォルトはoffです。
					</P
><P
>このパラメータは<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>の設定を再読み込みすることで変更可能です。
					</P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="RUNTIME-IN-MEMORY-QUERY-CACHE-CHOOSE-STORAGE"
>5.12.2. キャッシュストレージの選択</A
></H2
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><A
NAME="GUC-MEMQCACHE-METHOD"
></A
><TT
CLASS="VARNAME"
>memqcache_method</TT
> (<TT
CLASS="TYPE"
>string</TT
>)
					</DT
><DD
><P
>キャッシュに用いるストレージのタイプを指定します。
このパラメータで有効な全ての値のリストを以下の表に示します。
					</P
><DIV
CLASS="TABLE"
><A
NAME="MEMQCACHE-METHOD-TABLE"
></A
><P
><B
>表 5-10. Memcache method options</B
></P
><TABLE
BORDER="1"
CLASS="CALSTABLE"
><COL><COL><THEAD
><TR
><TH
>値</TH
><TH
>説明</TH
></TR
></THEAD
><TBODY
><TR
><TD
><TT
CLASS="LITERAL"
>'shmem'</TT
></TD
><TD
>共有メモリを使用</TD
></TR
><TR
><TD
><TT
CLASS="LITERAL"
>'memcached'</TT
></TD
><TD
><A
HREF="http://memcached.org/"
TARGET="_top"
>memcached</A
>を使用</TD
></TR
></TBODY
></TABLE
></DIV
><P
>デフォルトは<TT
CLASS="LITERAL"
>'shmem'</TT
>です。
					</P
><P
>このパラメータはサーバ起動時にのみ設定可能です。
					</P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="RUNTIME-IN-MEMORY-QUERY-CACHE-CONFIG"
>5.12.3. 共通設定</A
></H2
><P
>以下は<TT
CLASS="LITERAL"
>shmem</TT
>と<TT
CLASS="LITERAL"
>memcached</TT
>の両タイプのクエリキャッシュで有効なパラメータです。
    </P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><A
NAME="GUC-MEMQCACHEEXPIRE"
></A
><TT
CLASS="VARNAME"
>memqcache_expire</TT
> (<TT
CLASS="TYPE"
>integer</TT
>)
					</DT
><DD
><P
>クエリキャッシュの寿命を秒単位で設定します。
デフォルト0で、キャッシュの期限はなくなり、関連テーブルが更新されるまではキャッシュが有効になります。
          </P
><P
>このパラメータは<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>の設定を再読み込みすることで変更可能です。
					</P
><DIV
CLASS="NOTE"
><BLOCKQUOTE
CLASS="NOTE"
><P
><B
>注意: </B
><TT
CLASS="VARNAME"
>memqcache_expire</TT
>と<A
HREF="runtime-in-memory-query-cache.html#GUC-MEMQCACHE-AUTO-CACHE-INVALIDATION"
>memqcache_auto_cache_invalidation</A
>は互いに独立です。
            </P
></BLOCKQUOTE
></DIV
></DD
><DT
><A
NAME="GUC-MEMQCACHE-AUTO-CACHE-INVALIDATION"
></A
><TT
CLASS="VARNAME"
>memqcache_auto_cache_invalidation</TT
> (<TT
CLASS="TYPE"
>boolean</TT
>)
					</DT
><DD
><P
>onに設定した場合、更新されたテーブルに関連するキャッシュを自動で削除します。
offならばキャッシュは削除されません。
          </P
><P
>デフォルト値はonです。
          </P
><DIV
CLASS="NOTE"
><BLOCKQUOTE
CLASS="NOTE"
><P
><B
>注意: </B
><TT
CLASS="VARNAME"
>memqcache_auto_cache_invalidation</TT
>と<A
HREF="runtime-in-memory-query-cache.html#GUC-MEMQCACHEEXPIRE"
>memqcache_expire</A
>は互いに独立です。
            </P
></BLOCKQUOTE
></DIV
><P
>このパラメータは<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>の設定を再読み込みすることで変更可能です。
					</P
></DD
><DT
><A
NAME="GUC-MEMQCACHE-MAXCACHE"
></A
><TT
CLASS="VARNAME"
>memqcache_maxcache</TT
> (<TT
CLASS="TYPE"
>integer</TT
>)
					</DT
><DD
><P
>キャッシュされるSELECTクエリ結果の最大サイズをバイト数で指定します。
この値より大きいサイズのデータの結果は<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>にキャッシュされません。
サイズの制約によりデータのキャッシュができなかった場合、以下のメッセージが表示されます。
              </P><PRE
CLASS="PROGRAMLISTING"
>LOG:   pid 13756: pool_add_temp_query_cache: data size exceeds memqcache_maxcache. current:4095 requested:111 memq_maxcache:4096
              </PRE
><P>
          </P
><DIV
CLASS="NOTE"
><BLOCKQUOTE
CLASS="NOTE"
><P
><B
>注意: </B
>共有メモリによるクエリキャッシュ（<TT
CLASS="LITERAL"
>'shmem'</TT
>）の場合は、<TT
CLASS="VARNAME"
>memqcache_maxcache</TT
>は<A
HREF="runtime-in-memory-query-cache.html#GUC-MEMQCACHE-CACHE-BLOCK-SIZE"
>memqcache_cache_block_size</A
>を超えないように、<TT
CLASS="LITERAL"
>'memcached'</TT
>を使用する場合は、slabのサイズ(デフォルトで1MB)を超えないようにしてください。
            </P
></BLOCKQUOTE
></DIV
><P
>このパラメータは<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>の設定を再読み込みすることで変更可能です。
					</P
></DD
><DT
><A
NAME="GUC-WHITE-MEMQCACHE-TABLE-LIST"
></A
><TT
CLASS="VARNAME"
>white_memqcache_table_list</TT
> (<TT
CLASS="TYPE"
>string</TT
>)
					</DT
><DD
><P
>SELECT結果が<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>にキャッシュされるべきテーブル名のリストをカンマ区切りで指定します。
          </P
><P
>テーブル名のマッチングには正規表現も利用できます （指定した各表現に ^ と $ をつけた形で使われます）。
          </P
><DIV
CLASS="NOTE"
><BLOCKQUOTE
CLASS="NOTE"
><P
><B
>注意: </B
>スキーマ名を付けないテーブル名とスキーマ名を付けた形の両方をクエリの中で使う場合は、両方共リストに登録してください。
                </P><PRE
CLASS="PROGRAMLISTING"
>#For example:
#If the queries sometime use "table1" and other times "public.table1"
#to refer the table1 then the white_memqcache_table_list
#would be configured as follows.

white_memqcache_table_list = "table1,public.table1"

                </PRE
><P>

            </P
></BLOCKQUOTE
></DIV
><DIV
CLASS="NOTE"
><BLOCKQUOTE
CLASS="NOTE"
><P
><B
>注意: </B
><TT
CLASS="VARNAME"
>white_memqcache_table_list</TT
>は<A
HREF="runtime-in-memory-query-cache.html#GUC-BLACK-MEMQCACHE-TABLE-LIST"
>black_memqcache_table_list</A
>より優先されます。
            </P
></BLOCKQUOTE
></DIV
><P
>このパラメータは<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>の設定を再読み込みすることで変更可能です。
					</P
></DD
><DT
><A
NAME="GUC-BLACK-MEMQCACHE-TABLE-LIST"
></A
><TT
CLASS="VARNAME"
>black_memqcache_table_list</TT
> (<TT
CLASS="TYPE"
>string</TT
>)
					</DT
><DD
><P
>SELECT結果が<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>にキャッシュされる<SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>べきでない</I
></SPAN
>テーブル名のリストをカンマ区切りで指定します。
          </P
><P
>テーブル名のマッチングには正規表現も利用できます （指定した各表現に ^ と $ をつけた形で使われます）。
          </P
><DIV
CLASS="NOTE"
><BLOCKQUOTE
CLASS="NOTE"
><P
><B
>注意: </B
>スキーマ名を付けないテーブル名とスキーマ名を付けた形の両方をクエリの中で使う場合は、両方共リストに登録してください。
                </P><PRE
CLASS="PROGRAMLISTING"
>#For example:
#If the queries sometime use "table1" and other times "public.table1"
#to refer the table1 then the black_memqcache_table_list
#would be configured as follows.

black_function_list = "table1,public.table1"

                </PRE
><P>

            </P
></BLOCKQUOTE
></DIV
><P
>このパラメータは<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>の設定を再読み込みすることで変更可能です。
					</P
></DD
><DT
><A
NAME="GUC-MEMQCACHE-OIDDIR"
></A
><TT
CLASS="VARNAME"
>memqcache_oiddir</TT
> (<TT
CLASS="TYPE"
>string</TT
>)
					</DT
><DD
><P
>SELECTクエリが使用するテーブルに<TT
CLASS="LITERAL"
>OID</TT
>を格納するディレクトリへのフルパスで指定します。

          </P
><P
><TT
CLASS="VARNAME"
>memqcache_oiddir</TT
>には、各データベースのためのディレクトリが格納されます。
そのディレクトリ名はデータベースのOIDです。
更に、各データベースディレクトリその下には各テーブルの「ためのファイルが格納されます。
そのファイル名は同じくテーブルのOIDです。
これらのファイルの中にはクエリキャッシュへのポインタが格納されており、 キャッシュを削除する際のキーとして使われます。
          </P
><DIV
CLASS="NOTE"
><BLOCKQUOTE
CLASS="NOTE"
><P
><B
>注意: </B
><SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>の通常の再起動では<TT
CLASS="VARNAME"
>memqcache_oiddir</TT
>の中身はクリアされません。
            </P
></BLOCKQUOTE
></DIV
><P
>このパラメータは<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>の設定を再読み込みすることで変更可能です。
					</P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="RUNTIME-IN-MEMORY-QUERY-CACHE-SHMEM-CONFIG"
>5.12.4. 共有メモリ使用時の設定</A
></H2
><P
>これらはキャッシュストレージとして共有メモリを使用した場合に使われるパラメーターです。
    </P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><A
NAME="GUC-MEMQCACHE-TOTAL-SIZE"
></A
><TT
CLASS="VARNAME"
>memqcache_total_size</TT
> (<TT
CLASS="TYPE"
>integer</TT
>)
					</DT
><DD
><P
>共有メモリのキャッシュサイズをバイト単位で指定します。
					</P
><P
>このパラメータはサーバ起動時にのみ設定可能です。
					</P
></DD
><DT
><A
NAME="GUC-MEMQCACHE-MAX-NUM-CACHE"
></A
><TT
CLASS="VARNAME"
>memqcache_max_num_cache</TT
> (<TT
CLASS="TYPE"
>integer</TT
>)
					</DT
><DD
><P
>キャッシュエントリの数を指定します。
この設定項目は、キャッシュの管理領域の大きさを決めるために使用します。
					</P
><DIV
CLASS="NOTE"
><BLOCKQUOTE
CLASS="NOTE"
><P
><B
>注意: </B
>管理領域の大きさは、<TT
CLASS="VARNAME"
>memqcache_max_num_cache</TT
> * 48バイトで計算できます。
少なすぎるとキャッシュを登録することができずにエラーになります。
逆に多すぎると単に空間の無駄になります。
            </P
></BLOCKQUOTE
></DIV
><P
>このパラメータはサーバ起動時にのみ設定可能です。
					</P
></DD
><DT
><A
NAME="GUC-MEMQCACHE-CACHE-BLOCK-SIZE"
></A
><TT
CLASS="VARNAME"
>memqcache_cache_block_size</TT
> (<TT
CLASS="TYPE"
>integer</TT
>)
					</DT
><DD
><P
>キャッシュのブロックサイズを指定します。
<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>は<TT
CLASS="VARNAME"
>memqcache_cache_block_size</TT
>のブロックで管理されたキャッシュメモリを利用します。
SELECT結果はこのブロックに詰め込まれ、１つのブロックに収まらなければなりません。
従って、<TT
CLASS="VARNAME"
>memqcache_cache_block_size</TT
>を検索結果が超えると、キャッシュされません。。
					</P
><P
><TT
CLASS="VARNAME"
>memqcache_cache_block_size</TT
>は、512以上の値でなければなりません。
          </P
><P
>このパラメータはサーバ起動時にのみ設定可能です。
					</P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="RUNTIME-IN-MEMORY-QUERY-CACHE-MEMCACHED-CONFIG"
>5.12.5. memcached使用時の設定</A
></H2
><P
>これらはキャッシュストレージとしてmemcachedを使用した場合に使われるパラメーターです。
    </P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><A
NAME="GUC-MEMQCACHE-MEMCACHED-HOST"
></A
><TT
CLASS="VARNAME"
>memqcache_memcached_host</TT
> (<TT
CLASS="TYPE"
>string</TT
>)
					</DT
><DD
><P
><TT
CLASS="LITERAL"
>memcached</TT
>が動いているホスト名またはIPアドレスを指定します。
<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>と同じマシンで<TT
CLASS="LITERAL"
>memcached</TT
>を動かす場合は、<TT
CLASS="LITERAL"
>'localhost'</TT
>が使えます。
					</P
><P
>このパラメータはサーバ起動時にのみ設定可能です。
					</P
></DD
><DT
><A
NAME="GUC-MEMQCACHE-MEMCACHED-PORT"
></A
><TT
CLASS="VARNAME"
>memqcache_memcached_port</TT
> (<TT
CLASS="TYPE"
>integer</TT
>)
					</DT
><DD
><P
><ACRONYM
CLASS="ACRONYM"
>memcached</ACRONYM
>のポート番号を指定します。
デフォルトは 11211 です。

					</P
><P
>このパラメータはサーバ起動時にのみ設定可能です。
					</P
></DD
></DL
></DIV
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="runtime-streaming-replication-check.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>ホーム</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="runtime-ssl.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>ストリーミングレプリケーションのチェック</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="runtime-config.html"
ACCESSKEY="U"
>上に戻る</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Secure Sockect Layer (SSL)</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>